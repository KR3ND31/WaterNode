<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Automatic Irrigation Control</title>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
        <link rel="stylesheet" href="/static/css/style.css" />
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
        <script src="/static/js/i18n.js"></script>
    </head>
    <body class="p-4 bg-dark">
        <div class="container mt-4">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">

                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
                <h1 class="display-6 text-white mb-0" data-i18n="title">Automatic Irrigation System</h1>

                <!-- –ë–ª–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                <div class="d-flex align-items-center gap-3">
                  <!-- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è -->
                  <button class="btn btn-outline-primary d-flex align-items-center gap-2" onclick="discoverDevices()">
                    <i class="bi bi-search"></i>
                    <span data-i18n="discover">Discover Devices</span>
                  </button>

                  <!-- –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
                  <div class="d-flex align-items-center gap-2 text-white">
                    <i class="bi bi-arrow-repeat"></i>
                    <label for="update-interval" class="mb-0" data-i18n="update">Update:</label>
                    <select id="update-interval" class="form-select form-select-sm bg-dark text-white border-secondary w-auto">
                      <option value="1" data-i18n="interval.1">1 sec</option>
                      <option value="3" data-i18n="interval.3">3 sec</option>
                      <option value="5" selected data-i18n="interval.5">5 sec</option>
                      <option value="10" data-i18n="interval.10">10 sec</option>
                      <option value="30" data-i18n="interval.30">30 sec</option>
                    </select>
                  </div>
                  <div class="dropdown">
                      <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        üåê <span id="current-lang">EN</span>
                      </button>
                      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="langDropdown">
                        <li><a class="dropdown-item" href="#" onclick="setLanguage('en')">English</a></li>
                        <li><a class="dropdown-item" href="#" onclick="setLanguage('ru')">–†—É—Å—Å–∫–∏–π</a></li>
                      </ul>
                  </div>
                </div>
            </div>

            <!-- Device cards -->
            <h3 data-i18n="connected">Connected Devices</h3>
            <div id="device-cards" class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3 mb-4">
            <!-- Cards will be added dynamically via JS -->
            </div>
        </div>
        <div class="modal fade" id="chartModal" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content bg-dark text-light">
                    <div class="modal-header border-0">
                        <h5 class="modal-title" id="chartModalTitle" data-i18n="device_chart">Device Chart</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                            <div class="btn-group" role="group" aria-label="Period">
                                <button class="btn btn-outline-light btn-sm" id="btn-1h" onclick="changePeriod('1h')" data-i18n="period.1h">1h</button>
                                <button class="btn btn-outline-light btn-sm" id="btn-24h" onclick="changePeriod('24h')" data-i18n="period.24h">24h</button>
                                <button class="btn btn-outline-light btn-sm" id="btn-7d" onclick="changePeriod('7d')" data-i18n="period.7d">7d</button>
                                <button class="btn btn-outline-light btn-sm" id="btn-30d" onclick="changePeriod('30d')" data-i18n="period.30d">30d</button>
                            </div>
                            <div class="d-flex align-items-center gap-2">
                                <button class="btn btn-outline-secondary btn-sm" onclick="resetZoom()" data-i18n="reset_zoom">Reset Zoom</button>
                                <label for="smoothing-mode" class="mb-0 text-white small" data-i18n="smoothing">Smoothing:</label>
                                <select id="smoothing-mode" class="form-select form-select-sm bg-dark text-white border-secondary" style="width: auto;">
                                  <option value="none" data-i18n="smoothing_none">None</option>
                                  <option value="average" selected data-i18n="smoothing_avg">Average</option>
                                  <option value="median" data-i18n="smoothing_median">Median</option>
                                </select>
                            </div>
                        </div>
                        <div style="height: 300px;">
                            <canvas id="chartCanvas" style="height: 100%; width: 100%;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="settingsModal" tabindex="-1" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content bg-dark text-light border-secondary">

              <div class="modal-header border-0">
                <h5 class="modal-title d-flex align-items-center">
                  <i class="bi bi-gear me-2"></i>
                  <span id="settings-title" data-i18n="settings_title">Device Settings</span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>

              <div class="modal-body">
                <div class="mb-3">
                  <label for="device-name" class="form-label" data-i18n="device_name">Device Name</label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="device-name" placeholder="Enter device name">
                    <button class="btn btn-outline-secondary" type="button" id="btn-rename-device" data-i18n="rename_btn">Rename</button>
                  </div>
                </div>

                <!-- Raw moisture -->
                <div class="mb-3 d-flex justify-content-between align-items-center">
                  <span class="fw-semibold" data-i18n="raw_moisture"><i class="bi bi-droplet-half me-1"></i>Raw moisture:</span>
                  <strong id="raw-moisture">‚Äî</strong>
                </div>

                <!-- Calib min -->
                <div class="mb-3">
                  <label for="input-calib-min" class="form-label">
                      <i class="bi bi-arrow-down me-1"></i>
                      <span data-i18n="calib_min">Calibration Min</span>
                  </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="input-calib-min" placeholder="Enter value">
                    <button class="btn btn-outline-secondary" type="button" id="btn-remember-min" data-i18n="set_as_0">
                      Set as 0%
                    </button>
                  </div>
                </div>

                <!-- Calib max -->
                <div class="mb-3">
                  <label for="input-calib-max" class="form-label">
                      <i class="bi bi-arrow-up me-1"></i>
                      <span data-i18n="calib_max">Calibration Max</span>
                  </label>
                  <div class="input-group">
                    <input type="number" class="form-control" id="input-calib-max" placeholder="Enter value">
                    <button class="btn btn-outline-secondary" type="button" id="btn-remember-max" data-i18n="set_as_100">
                      Set as 100%
                    </button>
                  </div>
                </div>
              </div>

              <div class="modal-footer border-0">
                <button class="btn btn-primary w-100" id="btn-save-calibration">
                  <i class="bi bi-save me-1"></i>
                  <span data-i18n="save_calibration">Save Calibration</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/static/js/app.js"></script>
    </body>
</html>